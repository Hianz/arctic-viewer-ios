<!DOCTYPE html>

<html>
<head>
  <title>Arctic Viewer</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="/arctic-viewer-ios/css/main.css">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
<header class="site-header">

    <nav class="mobile-nav show-on-mobiles">
        <a class="page-link" href="/arctic-viewer-ios/"><i class="fa fa-home fa-fw fa-lg"></i></a>
        <a class="page-link" href="/arctic-viewer-ios/docs/home"><i class="fa fa-book fa-fw fa-lg"></i></a>
        <a class="page-link" href="/arctic-viewer-ios/news"><i class="fa fa-newspaper-o fa-fw fa-lg"></i></a>
    </nav>
    <div class="wrapper">

        <a class="site-title center-on-mobiles" href="/">
            <img src="/arctic-viewer-ios/img/logo.png" height="40" alt="Logo">
            Arctic Viewer
        </a>
        <nav class="site-nav hide-on-mobiles">
            <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </a>
            <div class="trigger">
                <a class="page-link" href="/arctic-viewer-ios/">Home</a>
                <a class="page-link" href="/arctic-viewer-ios/docs/home">Docs</a>
                <a class="page-link" href="/arctic-viewer-ios/news">News</a>
            </div>
        </nav>
    </div>

</header>

  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>MainViewController.swift</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="MainViewController.html">
                    MainViewController.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="MainViewTableCell.html">
                    MainViewTableCell.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="ObjCBridge.html">
                    ObjCBridge.h
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Paths.html">
                    Paths.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="TonicViewController.html">
                    TonicViewController.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="DemoServer.html">
                    DemoServer.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="HttpHandlers.html">
                    HttpHandlers.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="HttpParser.html">
                    HttpParser.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="HttpRequest.html">
                    HttpRequest.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="HttpResponse.html">
                    HttpResponse.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="HttpServer.html">
                    HttpServer.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Socket.html">
                    Socket.swift
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="viewer.html">
                    viewer.js
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        <p> MainViewController.swift
 ArcticViewer</p>
<p> Created by Tristan on 7/14/15.
 Copyright (c) 2015 Kitware. All rights reserved.</p>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">import</span> <span class="hljs-type">UIKit</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainViewController</span>: <span class="hljs-title">UITableViewController</span>, <span class="hljs-title">UITableViewDelegate</span>, <span class="hljs-title">UITableViewDataSource</span>,
    <span class="hljs-title">UINavigationControllerDelegate</span>,
    <span class="hljs-title">UIAlertViewDelegate</span> </span>{

    <span class="hljs-keyword">let</span> paths:<span class="hljs-type">Paths</span> = <span class="hljs-type">Paths</span>()
    <span class="hljs-keyword">let</span> store:<span class="hljs-type">NSUserDefaults</span> = <span class="hljs-type">NSUserDefaults</span>.standardUserDefaults()
    <span class="hljs-keyword">var</span> progress:<span class="hljs-type">NSProgress</span>!
    <span class="hljs-keyword">let</span> <span class="hljs-type">NVHProgressObserverContext</span>:<span class="hljs-type">UnsafeMutablePointer</span>&lt;<span class="hljs-type">Void</span>&gt; = <span class="hljs-type">UnsafeMutablePointer</span>&lt;<span class="hljs-type">Void</span>&gt;()
    
    <span class="hljs-preprocessor">@IBOutlet</span> <span class="hljs-keyword">var</span> table: <span class="hljs-type">UITableView</span>!
    <span class="hljs-keyword">var</span> dataFolders:[<span class="hljs-type">String</span>] = []
    <span class="hljs-keyword">var</span> cellToDelete:<span class="hljs-type">Int</span> = -<span class="hljs-number">1</span>
    <span class="hljs-keyword">var</span> dataFolderSizes:[<span class="hljs-type">String</span>:<span class="hljs-type">String</span>]!
    <span class="hljs-keyword">var</span> dataFolderThumbs:[<span class="hljs-type">String</span>:<span class="hljs-type">String</span>]!
    <span class="hljs-keyword">var</span> deflating:<span class="hljs-type">Bool</span> = <span class="hljs-literal">false</span>

    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.viewDidLoad()

        <span class="hljs-keyword">self</span>.title = <span class="hljs-string">"Datasets"</span>

        <span class="hljs-type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="hljs-keyword">self</span>, selector: <span class="hljs-type">Selector</span>(<span class="hljs-string">"handleURL:"</span>), name: <span class="hljs-string">"InboxFile"</span>, object: <span class="hljs-literal">nil</span>)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">viewWillAppear</span><span class="hljs-params">(animated: Bool)</span></span> {
        <span class="hljs-keyword">super</span>.viewWillAppear(animated)
        <span class="hljs-keyword">let</span> path:<span class="hljs-type">String</span> = <span class="hljs-keyword">self</span>.paths.datasetsDirectory().absoluteString!
        <span class="hljs-keyword">self</span>.dataFolders = (<span class="hljs-type">NSFileManager</span>.defaultManager().contentsOfDirectoryAtPath(path, error: <span class="hljs-literal">nil</span>) <span class="hljs-keyword">as</span>! [<span class="hljs-type">String</span>])
            .<span class="hljs-built_in">filter</span>({ (obj:<span class="hljs-type">String</span>) <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">if</span> obj.hasSuffix(<span class="hljs-string">".tar.gz"</span>) || obj.hasSuffix(<span class="hljs-string">".tgz"</span>) {</pre></div>
        
      
        
        <p>remove the extension so it doesn’t defalting twice</p>

        
          <div class='highlight'><pre>                    <span class="hljs-keyword">let</span> newName:<span class="hljs-type">String</span> = obj.componentsSeparatedByString(<span class="hljs-string">"."</span>).first!
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url:<span class="hljs-type">NSURL</span> = <span class="hljs-type">NSURL</span>(string: path)?.<span class="hljs-type">URLByAppendingPathComponent</span>(obj) {
                        <span class="hljs-built_in">println</span>(<span class="hljs-string">"deflating!"</span>)
                        <span class="hljs-keyword">let</span> newURL:<span class="hljs-type">NSURL</span> = <span class="hljs-type">NSURL</span>(string: path)!.<span class="hljs-type">URLByAppendingPathComponent</span>(newName)
                        <span class="hljs-type">NSFileManager</span>.defaultManager().moveItemAtPath(url.path!, toPath: newURL.path!, error: <span class="hljs-literal">nil</span>)
                        <span class="hljs-type">NSNotificationCenter</span>.defaultCenter().postNotificationName(<span class="hljs-string">"InboxFile"</span>, object: newURL)
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
                }
                <span class="hljs-keyword">return</span> obj != <span class="hljs-string">"Inbox"</span> &amp;&amp; <span class="hljs-keyword">self</span>.isDirectory(path + <span class="hljs-string">"/"</span> + obj)
            })

        <span class="hljs-keyword">self</span>.table.reloadData()</pre></div>
        
      
        
        <p>cleanse cached values</p>

        
          <div class='highlight'><pre>        <span class="hljs-keyword">self</span>.dataFolderSizes = store.dictionaryForKey(<span class="hljs-string">"data-folder-sizes"</span>) <span class="hljs-keyword">as</span>! [<span class="hljs-type">String</span>:<span class="hljs-type">String</span>]
        <span class="hljs-keyword">let</span> filteredMetadataKeys:[<span class="hljs-type">String</span>] = <span class="hljs-keyword">self</span>.dataFolderSizes.keys.array.<span class="hljs-built_in">filter</span>({el <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">contains</span>(<span class="hljs-keyword">self</span>.dataFolders, el)
        })

        <span class="hljs-keyword">var</span> tmpMetaData:[<span class="hljs-type">String</span>:<span class="hljs-type">String</span>] = <span class="hljs-type">Dictionary</span>()
        <span class="hljs-keyword">for</span> file:<span class="hljs-type">String</span> <span class="hljs-keyword">in</span> filteredMetadataKeys {
            tmpMetaData[file] = <span class="hljs-keyword">self</span>.dataFolderSizes[file]
        }
        <span class="hljs-keyword">self</span>.dataFolderSizes = tmpMetaData
        <span class="hljs-keyword">self</span>.store.setObject(tmpMetaData, forKey: <span class="hljs-string">"data-folder-sizes"</span>)

        <span class="hljs-keyword">self</span>.dataFolderThumbs = store.dictionaryForKey(<span class="hljs-string">"data-folder-thumbs"</span>) <span class="hljs-keyword">as</span>! [<span class="hljs-type">String</span>:<span class="hljs-type">String</span>]</pre></div>
        
      
        
        <p>println(“(self.dataFolderSizes)\n(self.dataFolderThumbs)”)</p>

        
          <div class='highlight'><pre>    }

    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">viewWillDisappear</span><span class="hljs-params">(animated: Bool)</span></span> {
        <span class="hljs-keyword">self</span>.store.setObject(<span class="hljs-keyword">self</span>.dataFolderSizes, forKey: <span class="hljs-string">"data-folder-sizes"</span>)
        <span class="hljs-keyword">self</span>.store.synchronize()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">didReceiveMemoryWarning</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.didReceiveMemoryWarning()</pre></div>
        
      
        
        <p>Dispose of any resources that can be recreated.</p>

        
          <div class='highlight'><pre>    }</pre></div>
        
      
        
        <p>MARK: TableView Delegates</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">tableView</span><span class="hljs-params">(tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.dataFolders.<span class="hljs-built_in">count</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">tableView</span><span class="hljs-params">(tableView: UITableView, cellForRowAtIndexPath indexPath: NSIndexPath)</span></span> -&gt; <span class="hljs-type">UITableViewCell</span> {
        <span class="hljs-keyword">var</span> cell:<span class="hljs-type">MainViewTableCell</span> = <span class="hljs-keyword">self</span>.table.dequeueReusableCellWithIdentifier(<span class="hljs-string">"cell"</span>) <span class="hljs-keyword">as</span>! <span class="hljs-type">MainViewTableCell</span>

        <span class="hljs-keyword">let</span> title:<span class="hljs-type">String</span> = <span class="hljs-keyword">self</span>.dataFolders[indexPath.row]
        cell.title?.text = title

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> size:<span class="hljs-type">String</span> = <span class="hljs-keyword">self</span>.dataFolderSizes[title] {
            cell.subtitle?.text = <span class="hljs-string">"Size: "</span> + size
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.deflating &amp;&amp; indexPath.row == <span class="hljs-keyword">self</span>.dataFolders.<span class="hljs-built_in">count</span> - <span class="hljs-number">1</span> {
            cell.subtitle?.text = <span class="hljs-string">"Decompressing dataset..."</span>
        }
        <span class="hljs-keyword">else</span> {</pre></div>
        
      
        
        <p>this can fail for very large files if synchronus.</p>

        
          <div class='highlight'><pre>            dispatch_async(dispatch_get_global_queue(<span class="hljs-type">DISPATCH_QUEUE_PRIORITY_BACKGROUND</span>, <span class="hljs-number">0</span>), {
                <span class="hljs-keyword">let</span> size:<span class="hljs-type">String</span> = <span class="hljs-keyword">self</span>.sizeForFolder(title)
                cell.subtitle?.text = <span class="hljs-string">"Size: "</span> + size

                <span class="hljs-keyword">self</span>.dataFolderSizes[title] = size
                <span class="hljs-keyword">self</span>.store.setObject(<span class="hljs-keyword">self</span>.dataFolderSizes, forKey: <span class="hljs-string">"data-folder-sizes"</span>)
            })
            cell.subtitle?.text = <span class="hljs-string">"Size: calculating..."</span>
        }

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> imageSrc:<span class="hljs-type">String</span> = <span class="hljs-keyword">self</span>.dataFolderThumbs[title] {
            cell.thumb?.sd_setImageWithURL(<span class="hljs-type">NSURL</span>(string:imageSrc))
        }
        <span class="hljs-keyword">else</span> {
            cell.thumb?.image = <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">"null-image"</span>, inBundle: <span class="hljs-type">NSBundle</span>.mainBundle(), compatibleWithTraitCollection: <span class="hljs-literal">nil</span>)
        }

        <span class="hljs-keyword">return</span> cell
    }

    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">tableView</span><span class="hljs-params">(tableView: UITableView, didSelectRowAtIndexPath indexPath: NSIndexPath)</span></span> {
        tableView.deselectRowAtIndexPath(indexPath, animated: <span class="hljs-literal">true</span>)

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.deflating &amp;&amp; indexPath.row == <span class="hljs-keyword">self</span>.dataFolders.<span class="hljs-built_in">count</span> - <span class="hljs-number">1</span> {
            <span class="hljs-built_in">println</span>(<span class="hljs-string">"not available"</span>)
            <span class="hljs-keyword">return</span>
        }

        <span class="hljs-keyword">let</span> webContentPath:<span class="hljs-type">NSURL</span> = <span class="hljs-keyword">self</span>.paths.webcontentData()
        <span class="hljs-keyword">let</span> dataPath:<span class="hljs-type">NSURL</span> = <span class="hljs-keyword">self</span>.paths.datasetsSubdirectory(dataFolders[indexPath.row])

        <span class="hljs-keyword">let</span> error:<span class="hljs-type">NSErrorPointer</span> = <span class="hljs-type">NSErrorPointer</span>()
        <span class="hljs-type">NSFileManager</span>.defaultManager().removeItemAtPath(webContentPath.absoluteString!, error: <span class="hljs-literal">nil</span>)
        <span class="hljs-type">NSFileManager</span>.defaultManager().createSymbolicLinkAtPath(webContentPath.absoluteString!, withDestinationPath: dataPath.absoluteString!, error: error)

        <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> {
            <span class="hljs-built_in">println</span>(<span class="hljs-string">"problem creating symlink"</span>)
            <span class="hljs-built_in">println</span>(error.debugDescription)
            <span class="hljs-keyword">return</span>
        }

        presentTonicView(<span class="hljs-keyword">self</span>.dataFolders[indexPath.row])
    }

    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">tableView</span><span class="hljs-params">(tableView: UITableView, commitEditingStyle editingStyle: UITableViewCellEditingStyle, forRowAtIndexPath indexPath: NSIndexPath)</span></span> {
        <span class="hljs-keyword">self</span>.cellToDelete = indexPath.row
        <span class="hljs-keyword">let</span> alert:<span class="hljs-type">UIAlertView</span> = <span class="hljs-type">UIAlertView</span>(title: <span class="hljs-string">"Delete dataset?"</span>, message: <span class="hljs-string">"<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.dataFolders[indexPath.row])</span> will be deleted from the device."</span>, delegate: <span class="hljs-keyword">self</span>, cancelButtonTitle: <span class="hljs-string">"Delete"</span>, otherButtonTitles: <span class="hljs-string">"Cancel"</span>)
        alert.show()
    }</pre></div>
        
      
        
        <p>MARK: misc</p>

        
          <div class='highlight'><pre>    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">handleURL</span><span class="hljs-params">(notifURL:NSNotification)</span></span> {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url:<span class="hljs-type">NSURL</span> = notifURL.object <span class="hljs-keyword">as</span>? <span class="hljs-type">NSURL</span> {
            <span class="hljs-keyword">let</span> fName:<span class="hljs-type">String</span> = url.lastPathComponent!.componentsSeparatedByString(<span class="hljs-string">"."</span>).first!
            <span class="hljs-keyword">self</span>.preparDeflate()
            dispatch_async(dispatch_get_main_queue(), {
                <span class="hljs-keyword">self</span>.dataFolders.append(fName)
                <span class="hljs-keyword">self</span>.deflating = <span class="hljs-literal">true</span>
                <span class="hljs-keyword">self</span>.table.reloadData()

                <span class="hljs-type">NVHTarGzip</span>.sharedInstance().unTarGzipFileAtPath(url.path!, toPath: <span class="hljs-keyword">self</span>.paths.datasetsDirectory().path!,
                completion: { (error:<span class="hljs-type">NSError</span>!) -&gt; <span class="hljs-type">Void</span> <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">self</span>.completeDeflate(error)
                    <span class="hljs-keyword">self</span>.deflating = <span class="hljs-literal">false</span>
                    <span class="hljs-keyword">self</span>.table.reloadData()

                    <span class="hljs-type">NSFileManager</span>.defaultManager().removeItemAtPath(url.path!, error: <span class="hljs-literal">nil</span>)
                })
            })
        }
    }
    
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">preparDeflate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">self</span>.progress = <span class="hljs-type">NSProgress</span>(totalUnitCount: <span class="hljs-number">1</span>)
        <span class="hljs-keyword">let</span> keyPath:<span class="hljs-type">String</span> = <span class="hljs-string">"fractionCompleted"</span>
        <span class="hljs-keyword">self</span>.progress.addObserver(<span class="hljs-keyword">self</span>, forKeyPath: keyPath,
            options: <span class="hljs-type">NSKeyValueObservingOptions</span>.<span class="hljs-type">Initial</span>,
            context: <span class="hljs-keyword">self</span>.<span class="hljs-type">NVHProgressObserverContext</span>)
        <span class="hljs-keyword">self</span>.progress.becomeCurrentWithPendingUnitCount(<span class="hljs-number">1</span>)
    }
    
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">completeDeflate</span><span class="hljs-params">(error:NSError!)</span></span> {
        <span class="hljs-keyword">let</span> keyPath:<span class="hljs-type">String</span> = <span class="hljs-string">"fractionCompleted"</span>
        <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> {
            <span class="hljs-built_in">println</span>(<span class="hljs-string">"issue decompressing!"</span>)
        }
        <span class="hljs-keyword">self</span>.progress.resignCurrent()
        <span class="hljs-keyword">self</span>.progress.removeObserver(<span class="hljs-keyword">self</span>, forKeyPath: keyPath, context: <span class="hljs-keyword">self</span>.<span class="hljs-type">NVHProgressObserverContext</span>)
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">observeValueForKeyPath</span><span class="hljs-params">(keyPath: String, ofObject object: AnyObject, change: [NSObject : AnyObject], context: UnsafeMutablePointer&lt;Void&gt;)</span></span> {
        <span class="hljs-keyword">if</span> context == <span class="hljs-keyword">self</span>.<span class="hljs-type">NVHProgressObserverContext</span> {
            <span class="hljs-keyword">let</span> _progress:<span class="hljs-type">NSProgress</span> = object <span class="hljs-keyword">as</span>! <span class="hljs-type">NSProgress</span>;
            <span class="hljs-type">NSOperationQueue</span>.mainQueue().addOperationWithBlock({
                <span class="hljs-keyword">if</span> fmod(_progress.fractionCompleted * <span class="hljs-number">100</span>, <span class="hljs-number">10.0</span>) == <span class="hljs-number">0</span> {
                    <span class="hljs-built_in">println</span>(_progress.fractionCompleted)
                }
            })
        }
    }

    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">alertView</span><span class="hljs-params">(alertView: UIAlertView, clickedButtonAtIndex buttonIndex: Int)</span></span> {
        <span class="hljs-keyword">switch</span> (buttonIndex) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            <span class="hljs-keyword">self</span>.tableView.setEditing(<span class="hljs-literal">false</span>, animated: <span class="hljs-literal">true</span>)
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
            <span class="hljs-keyword">let</span> path:<span class="hljs-type">NSURL</span> = <span class="hljs-keyword">self</span>.paths.datasetsSubdirectory(<span class="hljs-keyword">self</span>.dataFolders[<span class="hljs-keyword">self</span>.cellToDelete])
            dispatch_async(dispatch_get_global_queue(<span class="hljs-type">DISPATCH_QUEUE_PRIORITY_DEFAULT</span>, <span class="hljs-number">0</span>), {
                <span class="hljs-type">NSFileManager</span>.defaultManager().removeItemAtPath(path.absoluteString!, error: <span class="hljs-literal">nil</span>)
            })

            <span class="hljs-keyword">self</span>.dataFolderSizes.removeValueForKey(<span class="hljs-keyword">self</span>.dataFolders[<span class="hljs-keyword">self</span>.cellToDelete])
            <span class="hljs-type">NSUserDefaults</span>.standardUserDefaults().setObject(<span class="hljs-keyword">self</span>.dataFolderSizes, forKey: <span class="hljs-string">"data-folder-sizes"</span>)

            <span class="hljs-keyword">self</span>.dataFolders.removeAtIndex(<span class="hljs-keyword">self</span>.cellToDelete)
            <span class="hljs-keyword">self</span>.table.reloadData()

            <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.dataFolders.<span class="hljs-built_in">count</span> == <span class="hljs-number">0</span> {
                <span class="hljs-keyword">self</span>.table.setEditing(<span class="hljs-literal">false</span>, animated: <span class="hljs-literal">true</span>)
            }

            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">break</span>
        }
        <span class="hljs-keyword">self</span>.cellToDelete = -<span class="hljs-number">1</span>
    }

    <span class="hljs-preprocessor">@IBAction</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">addDataset</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">self</span>.table.setEditing(<span class="hljs-literal">false</span>, animated: <span class="hljs-literal">false</span>)
    }

    <span class="hljs-preprocessor">@IBAction</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">showAboutPage</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">let</span> newController:<span class="hljs-type">AboutViewController</span> = storyboard?.instantiateViewControllerWithIdentifier(<span class="hljs-string">"AboutViewController"</span>) <span class="hljs-keyword">as</span>! <span class="hljs-type">AboutViewController</span>
        newController.title = <span class="hljs-string">"About"</span>
        navigationController?.pushViewController(newController, animated: <span class="hljs-literal">true</span>)
    }

    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">presentTonicView</span><span class="hljs-params">(viewTitle:String)</span></span> {
        <span class="hljs-keyword">let</span> newController = storyboard?.instantiateViewControllerWithIdentifier(<span class="hljs-string">"TonicViewController"</span>) <span class="hljs-keyword">as</span>! <span class="hljs-type">TonicViewController</span>
        newController.title = viewTitle
        navigationController?.pushViewController(newController, animated: <span class="hljs-literal">true</span>)
    }

    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">sizeForFolder</span><span class="hljs-params">(folderName:String)</span></span> -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">let</span> folderPath:<span class="hljs-type">String</span> = <span class="hljs-keyword">self</span>.paths.datasetsSubdirectory(folderName).absoluteString!
        <span class="hljs-keyword">if</span> !<span class="hljs-type">NSFileManager</span>.defaultManager().fileExistsAtPath(folderPath) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>
        }
        <span class="hljs-keyword">let</span> contents:[<span class="hljs-type">String</span>] = <span class="hljs-type">NSFileManager</span>.defaultManager().subpathsOfDirectoryAtPath(folderPath, error: <span class="hljs-literal">nil</span>)! <span class="hljs-keyword">as</span>! [<span class="hljs-type">String</span>]
        <span class="hljs-keyword">var</span> folderSize:<span class="hljs-type">UInt64</span> = <span class="hljs-number">0</span>

        <span class="hljs-keyword">for</span> file:<span class="hljs-type">String</span> <span class="hljs-keyword">in</span> contents {
            <span class="hljs-keyword">let</span> fDict:<span class="hljs-type">NSDictionary</span> = <span class="hljs-type">NSFileManager</span>.defaultManager().attributesOfItemAtPath(
                folderPath + <span class="hljs-string">"/"</span> + file, error: <span class="hljs-literal">nil</span>)!
            folderSize += fDict.fileSize()
        }
        <span class="hljs-keyword">return</span> <span class="hljs-type">NSByteCountFormatter</span>.stringFromByteCount(<span class="hljs-type">Int64</span>(folderSize), countStyle: <span class="hljs-type">NSByteCountFormatterCountStyle</span>.<span class="hljs-type">File</span>)
    }

    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">isDirectory</span><span class="hljs-params">(path:String)</span></span> -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">var</span> isDir:<span class="hljs-type">ObjCBool</span> = <span class="hljs-literal">false</span>
        <span class="hljs-keyword">let</span> exists = <span class="hljs-type">NSFileManager</span>.defaultManager().fileExistsAtPath(path, isDirectory: &amp;isDir)
        <span class="hljs-keyword">return</span> isDir.boolValue
    }
}</pre></div>
        
      
    </div>
  </div>
</body>
</html>
